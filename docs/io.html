<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<title>Untitled Document</title>
<link href="basics.css" rel="stylesheet" type="text/css" />
</head>

<body>
 <h1>I/O Handling </h1>
 <p>One of the key advantages of using Conrad for gene calling or other CRF problems is its ability to quickly and easy create a predictor by combining together different sets of features.  Conrad has a very powerful I/O mechanism to handle this interaction, but in order to take advantage of this power you must understand how the I/O works. The following picture describes how the various I/O classes work together:</p>
 <p><img src="io.png" alt="I/O class diagram" width="659" height="370" /></p>
 <p>&nbsp;</p>
 <h2>How input data is structured </h2>
 <p>The  simplest place to start is to understand how the input data is presented to the features in the model. For more information on the features themselves, see the <a href="features.html">features section</a> of the documentation. We will begin by covering the evaluation process and then cover training. </p>
 <p>When input data is read in, it is read in to a list of <a href="api/calhoun/analysis/crf/io/InputSequence.html" target="_parent"><span class="Computer">InputSequence</span></a> objects. Each element in the list corresponds to a separate sequence of hidden states. Each one of these <a href="api/calhoun/analysis/crf/io/InputSequence.html" target="_parent"><span class="Computer">InputSequence</span></a> objects contains the observations for a single sequence. There are several different types of <a href="api/calhoun/analysis/crf/io/InputSequence.html" target="_parent"><span class="Computer">InputSequence</span></a> objects that correspond to different types of data. An <a href="api/calhoun/analysis/crf/io/InputSequenceCharacter.html" target="_parent"><span class="Computer">InputSequenceCharacter</span></a> is an sequence which is a text string, an <a href="api/calhoun/analysis/crf/io/InputSequenceBoolean.html" target="_parent"><span class="Computer">InputSequenceBoolean</span></a> contains a single boolean value at each position, etc. There is also an <a href="api/calhoun/analysis/crf/io/InputSequenceComposite.html" target="_parent"><span class="Computer">InputSequenceComposite</span></a> which corresponds to an input sequence that contains multiple data types. In most non-trival prediction problems, the input sequence will be a composite. Users are even free to define their own types of  <a href="api/calhoun/analysis/crf/io/InputSequence.html" target="_parent"><span class="Computer">InputSequence</span></a>. We do this for gene calling to provide special processing for multiple alignments. Any object that implements the <a href="api/calhoun/analysis/crf/io/InputSequence.html" target="_parent"><span class="Computer">InputSequence</span></a> interface can be used. </p>
 <p>An <a href="api/calhoun/analysis/crf/io/InputSequenceComposite.html" target="_parent"><span class="Computer">InputSequenceComposite</span></a> is just a collection of <a href="api/calhoun/analysis/crf/io/InputSequence.html" target="_parent"><span class="Computer">InputSequence</span></a> objects along with a name assigned to each one. In the <strong>comparative.xml</strong> model, the input sequence contains several components:</p>
 <ul>
   <li><strong>name</strong> - The name of the input sequence</li>
   <li><strong>ref</strong> - The genome sequence of the input sequence </li>
   <li><strong>aln</strong> - A special type of input sequence, a <a href="api/calhoun/analysis/crf/io/MultipleAlignmentInputSequence.html" target="_parent"><span class="Computer">MultipleAlignmentInputSequence</span></a> which contains special information for features that use mulitple alignments. </li>
 </ul>
 <p>When performing training, the hidden states are required in addition to the input sequences. Training data is represented using a <a href="api/calhoun/analysis/crf/io/TrainingSequence.html" target="_parent"><span class="Computer">TrainingSequence</span></a> object. A <a href="api/calhoun/analysis/crf/io/TrainingSequence.html" target="_parent"><span class="Computer">TrainingSequence</span></a> sequence contains an <a href="api/calhoun/analysis/crf/io/InputSequence.html" target="_parent"><span class="Computer">InputSequence</span></a> along with an array of integers contianing the hidden state for each position.</p>
 <h2>Passing data to features </h2>
 <p>One of the major goals of Conrad is to make it easy to write individual features and then combine them in different models. Because different models may use different input data, we don't want to have to make the feature dependent on the structure of the input data. So Conrad contains configuration that allows an individual feature in a particular model to be associated with a particular component of the input. Each <a href="api/calhoun/analysis/crf/FeatureManager.html" target="_parent"><span class="Computer">FeatureManager</span></a> contains an <strong>inputComponent</strong> property that defines which component of the input sequence it should receive. All calls to training and inference functions will then pass only that component to the <a href="api/calhoun/analysis/crf/FeatureManager.html" target="_parent"><span class="Computer">FeatureManager</span></a>. As an example, the <a href="api/calhoun/analysis/crf/features/interval13/PWMInterval13.html"><span class="Computer">PWMInterval13</span></a> feature is written to use only the genome sequence to compute it's feature values. As the genome sequence is a text string, this feature expects to receive an <a href="api/calhoun/analysis/crf/io/InputSequenceCharacter.html" target="_parent"><span class="Computer">InputSequenceCharacter</span></a> object as it's input. When placed in a realistic model that contains multiple sources of input data such as the <strong>comparative.xml</strong> model, the <a href="api/calhoun/analysis/crf/features/interval13/PWMInterval13.html"><span class="Computer">PWMInterval13</span></a> can be configured to only receive the genome sequence as input by assigning it's <strong>inputComponent</strong> as <span class="Computer">ref</span>. It will never see or have access to the other input data such as the comparative alignments.  This makes it easy to combine different features and input data together.</p>
 <p>Similarly, Conrad ensures that this separation into components occurs for both evaluation and training. During the training process, the feature will be handed a series of <a href="api/calhoun/analysis/crf/io/TrainingSequence.html" target="_parent"><span class="Computer">TrainingSequence</span></a> objects where each training sequence contains the series of hidden states associated with the specific component of the input data desired by the feature.</p>
 <h2>Reading in data</h2>
 <p>Now that we understand how the data is represented internally and presented to the engine, we can look at how a set of input data files is configured to read in and create the list of <a href="api/calhoun/analysis/crf/io/InputSequence.html" target="_parent"><span class="Computer">InputSequence</span></a> and <a href="api/calhoun/analysis/crf/io/TrainingSequence.html" target="_parent"><span class="Computer">TrainingSequence</span></a><a href="api/calhoun/analysis/crf/io/InputSequence.html" target="_parent"></a> objects. There are two major pieces to this, the <a href="api/calhoun/analysis/crf/io/InputHandler.html" target="_parent"><span class="Computer">InputHandler</span></a> and the <a href="api/calhoun/analysis/crf/io/InputComponentIO.html" target="_parent"><span class="Computer">InputComponentIO</span></a>.</p>
 <p>There is only one <a href="api/calhoun/analysis/crf/io/InputHandler.html" target="_parent"><span class="Computer">InputHandler</span></a>, and it is the object that the Conrad engine actually looks up by name in the model file. This object controls how the data location passed to the Conrad engine will be interpreted. The most common input handler is the <a href="api/calhoun/analysis/crf/io/InputHandlerDirectory.html" target="_parent"><span class="Computer">InputHandlerDirectory</span></a>, which assumes that the location which is passed in is a directory and that directory will contain a consistently named set of files and each file will contain one type of data for all of the input sequences. If you have a different input format, such as having a single file per input sequence, you can use a different input handler to accomodate that. In this section we will only describe the operation of the <a href="api/calhoun/analysis/crf/io/InputHandlerDirectory.html" target="_parent"><span class="Computer">InputHandlerDirectory</span></a>.</p>
 <p>The <a href="api/calhoun/analysis/crf/io/InputHandlerDirectory.html" target="_parent"><span class="Computer">InputHandlerDirectory</span></a> is configured with a set of files, and each file has an associated <a href="api/calhoun/analysis/crf/io/InputComponentIO.html" target="_parent"><span class="Computer">InputComponentIO</span></a> which is responsible for reading in that file and populating one or more components of the <a href="api/calhoun/analysis/crf/io/InputSequenceComposite.html" target="_parent"><span class="Computer">InputSequenceComposite</span></a>. Each <a href="api/calhoun/analysis/crf/io/InputComponentIO.html" target="_parent"><span class="Computer">InputComponentIO</span></a> can be specific to a given file format. In Conrad, we use a different one for each file format we use: <a href="api/calhoun/analysis/crf/io/FastaInput.html" target="_parent" class="Computer">FastaInput</a>, <a href="api/calhoun/analysis/crf/io/FastaAlignmentInput.html" target="_parent"><span class="Computer">FastaAlignmentInput</span></a>, <a href="api/calhoun/analysis/crf/io/MultipleAlignmentInput.html" target="_parent"><span class="Computer">MultipleAlignmentInput</span></a>, and <a href="api/calhoun/analysis/crf/io/GTFInputInterval13.html" target="_parent" class="Computer">GTFInputInterval13</a>. For reading in training sequences, there is a <a href="api/calhoun/analysis/crf/io/TrainingSequenceIO.html" target="_parent"><span class="Computer">TrainingSequenceIO</span></a> object which is analagous to the <a href="api/calhoun/analysis/crf/io/InputComponentIO.html" target="_parent"><span class="Computer">InputComponentIO</span></a> but reads in the array of hidden states.</p>
 <h2>Why all these classes?</h2>
 <p>In developing Conrad we used many different data configurations, features, and data types. In the end we found that the most efficient system was to separate how the data was represented internally (InputSequences) from how individual data files were read in (InputComponentIO) and from how the overall set of data is configured (InputComponentIO). The resulting system is flexible and allows a high amount of reuse. By decoupling these things, it is possible for the same feature function to be easily used on a DNA sequence read out of a FASTA file containing other sequences or embedded in a Genbank record, possibly one downloaded on the fly. It also allows addiitonal objects to be easily added for new data. </p>
</body>
</html>
